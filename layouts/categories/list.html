{{ define "main" }}
{{ if eq .RelPermalink "/categories/" }}
<!-- CATEGORIES INDEX PAGE -->
<div class="categories-container">
    <h1>Blog Categories</h1>
    <div class="categories-grid">
        {{ range $.Site.Taxonomies.categories.ByCount }}
        <a href="/categories/{{ .Name | urlize }}" class="category-card">
            <h3>{{ .Name }}</h3>
            <span class="post-count">{{ .Count }} post{{ if ne .Count 1 }}s{{ end }}</span>
        </a>
        {{ end }}
    </div>
</div>
{{ else }}
<!-- INDIVIDUAL CATEGORY PAGE -->
<div class="list">
    <div class="category-header">
        <h1>Category: {{ .Title }}</h1>
        <p>Showing all posts in this category</p>
    </div>

    {{ range .Paginator.Pages }}
    {{ $page := . }}
    <div class="listItem">
        <a href="{{ .Permalink }}" class="listItemImageLink">
            {{ with .Params.image }}
            <img src="{{ . }}" alt="{{ $page.Title }}" class="listItemImage" loading="lazy" width="300" height="200">
            {{ else }}
            <div class="listItemImage placeholder"></div>
            {{ end }}
        </a>

        <div class="listItemText">
            <h1 class="listItemTitle">
                <a href="{{ .Permalink }}">{{ .Title }}</a>
            </h1>

            {{ with .Description }}
            <p class="listItemDesc">{{ . }}</p>
            {{ else }}
            <p class="listItemDesc">{{ .Summary | truncate 150 }}</p>
            {{ end }}

            <div class="listItemDetail">
                {{ with .Params.avatar }}
                <img src="{{ . }}" loading="lazy" alt="Author" class="listItemAvatar" width="24" height="24">
                {{ end }}

                {{ with .Params.author }}
                <span class="listItemAuthor">{{ . }}</span>
                {{ else }}
                {{ range (.GetTerms "authors") }}
                <a href="{{ .Permalink }}" class="listItemAuthor">{{ .Name }}</a>
                {{ end }}
                {{ end }}

                <time datetime="{{ .Date.Format " 2006-01-02" }}" class="listItemDate">
                    {{ .Date.Format "Jan 2, 2006" }}
                </time>
            </div>

            <div class="listItemCategories">
                {{ range (.GetTerms "categories") }}
                <a class="listItemCategory" href="{{ .Permalink }}">{{ .Name }}</a>
                {{ end }}
            </div>
        </div>
    </div>
    {{ end }}
</div>

{{ if gt .Paginator.TotalPages 1 }}
<nav class="pagination">
    {{ if .Paginator.HasPrev }}
    <a href="{{ .Paginator.Prev.URL }}" class="pagination-prev">&laquo; Newer</a>
    {{ end }}
    <span class="pagination-page">Page {{ .Paginator.PageNumber }}</span>
    {{ if .Paginator.HasNext }}
    <a href="{{ .Paginator.Next.URL }}" class="pagination-next">Older &raquo;</a>
    {{ end }}
</nav>
{{ end }}
{{ end }}
{{ end }}